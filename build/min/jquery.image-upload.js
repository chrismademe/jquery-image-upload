!function(n){n.fn.imageUpload=function(e){var o={url:null,container:this.parent(),allowed:["jpg","jpeg","gif","png"],form:"#form",handler:"upload.php",onInit:function(){},onSuccess:function(){},onFail:function(){},onError:function(){}},a=n.extend({},o,e);"function"==typeof a.onInit&&a.onInit(),this.on("change",function(){n(a.container).find(".iu-alert").remove(),n(a.container).append('<span class="iu-spinner"><img src="working.gif" width="20" height="20"></span>');var e=n(this),o=n(this).val(),i=o.substr(o.indexOf(".")+1),r=!1;n.each(a.allowed,function(n,e){return i===e?void(r=!0):void 0}),r?(data=new FormData(n(a.form)[0]),n.ajax({url:a.handler,type:"POST",xhr:function(){var e=n.ajaxSettings.xhr();return e},success:function(o){200===o.code?(a.url=o.url,n(a.container).append('<span class="iu-alert iu-success">Upload complete.</span>'),e.replaceWith(e.val("").clone(!0)),"function"==typeof a.onSuccess&&a.onSuccess()):(n(a.container).append('<span class="iu-alert iu-error">Something went wrong, your image was not uploaded.</span>'),"function"==typeof a.onFail&&a.onFail()),n(".iu-spinner").remove()},error:function(e){n(a.container).append('<span class="iu-alert iu-error">Something went wrong, your image was not uploaded.</span>'),n(".iu-spinner").remove(),"function"==typeof a.onError&&a.onError()},data:data,cache:!1,contentType:!1,processData:!1})):(n(a.container).append('<span class="iu-alert iu-error">Provided file is invalid.</span>'),n(a.container).find(".iu-spinner").remove())})}}(jQuery);